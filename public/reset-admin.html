<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reset Admin Dashboard</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 600px;
      width: 100%;
      padding: 40px;
      text-align: center;
    }

    h1 {
      color: #667eea;
      font-size: 32px;
      margin-bottom: 10px;
    }

    .subtitle {
      color: #666;
      font-size: 16px;
      margin-bottom: 30px;
    }

    .warning-box {
      background: #fff3cd;
      border: 2px solid #ffc107;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 30px;
      text-align: left;
    }

    .warning-box h3 {
      color: #ff6b00;
      font-size: 18px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .warning-box ul {
      list-style: none;
      padding: 0;
    }

    .warning-box li {
      padding: 8px 0;
      color: #666;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .warning-box li::before {
      content: "üóëÔ∏è";
      font-size: 16px;
    }

    .button-group {
      display: flex;
      gap: 15px;
      margin-top: 30px;
    }

    .btn {
      flex: 1;
      padding: 15px 30px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .btn-danger {
      background: #dc3545;
      color: white;
    }

    .btn-danger:hover {
      background: #c82333;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
    }

    .btn-danger:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .status-box {
      background: #d4edda;
      border: 2px solid #28a745;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
      display: none;
    }

    .status-box.success {
      display: block;
    }

    .status-box h3 {
      color: #28a745;
      font-size: 20px;
      margin-bottom: 15px;
    }

    .status-list {
      text-align: left;
      list-style: none;
      padding: 0;
    }

    .status-list li {
      padding: 8px 0;
      color: #155724;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-list li::before {
      content: "‚úÖ";
      font-size: 16px;
    }

    .emoji {
      font-size: 48px;
      margin-bottom: 20px;
    }

    .info-box {
      background: #e7f3ff;
      border: 2px solid #0088cc;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      text-align: left;
    }

    .info-box p {
      color: #004466;
      margin: 5px 0;
    }

    .info-box strong {
      color: #0088cc;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="emoji">üßπ</div>
    <h1>Reset Admin Dashboard</h1>
    <p class="subtitle">Clean all local data and start fresh</p>

    <div class="warning-box">
      <h3>‚ö†Ô∏è Warning: This will delete:</h3>
      <ul>
        <li>All cached data</li>
        <li>Stored authentication tokens</li>
        <li>User preferences</li>
        <li>Session data</li>
        <li>Redux store state</li>
        <li>Local storage data</li>
        <li>Service worker cache</li>
      </ul>
    </div>

    <div class="info-box">
      <p><strong>After reset, you'll need to:</strong></p>
      <p>1. Login again with admin credentials</p>
      <p>2. Reconfigure any custom settings</p>
    </div>

    <div class="button-group">
      <button class="btn btn-secondary" onclick="goBack()">Cancel</button>
      <button class="btn btn-danger" onclick="resetDashboard()">
        <span id="btnText">Reset Everything</span>
      </button>
    </div>

    <div class="status-box" id="statusBox">
      <h3>‚úÖ Dashboard Reset Complete!</h3>
      <ul class="status-list" id="statusList"></ul>
      <button class="btn btn-secondary" onclick="reload()" style="margin-top: 20px; width: 100%;">
        Reload Dashboard
      </button>
    </div>
  </div>

  <script>
    function goBack() {
      window.history.back();
    }

    function reload() {
      window.location.href = '/';
    }

    function addStatus(message) {
      const statusList = document.getElementById('statusList');
      const li = document.createElement('li');
      li.textContent = message;
      statusList.appendChild(li);
    }

    async function resetDashboard() {
      const btnText = document.getElementById('btnText');
      const statusBox = document.getElementById('statusBox');
      
      if (!confirm('Are you absolutely sure? This cannot be undone!')) {
        return;
      }

      // Show loading
      btnText.innerHTML = '<span class="spinner"></span> Resetting...';
      document.querySelector('.btn-danger').disabled = true;

      try {
        // 1. Clear localStorage
        console.log('Clearing localStorage...');
        localStorage.clear();
        addStatus('Cleared localStorage');

        // 2. Clear sessionStorage
        console.log('Clearing sessionStorage...');
        sessionStorage.clear();
        addStatus('Cleared sessionStorage');

        // 3. Clear cookies
        console.log('Clearing cookies...');
        const cookies = document.cookie.split(';');
        for (let cookie of cookies) {
          const eqPos = cookie.indexOf('=');
          const name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
          document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/';
        }
        addStatus('Cleared cookies');

        // 4. Clear IndexedDB
        console.log('Clearing IndexedDB...');
        if (window.indexedDB) {
          const databases = await window.indexedDB.databases();
          for (const db of databases) {
            window.indexedDB.deleteDatabase(db.name);
          }
          addStatus('Cleared IndexedDB');
        }

        // 5. Unregister service workers
        console.log('Unregistering service workers...');
        if ('serviceWorker' in navigator) {
          const registrations = await navigator.serviceWorker.getRegistrations();
          for (const registration of registrations) {
            await registration.unregister();
          }
          addStatus('Unregistered service workers');
        }

        // 6. Clear Cache API
        console.log('Clearing Cache API...');
        if ('caches' in window) {
          const cacheNames = await caches.keys();
          for (const cacheName of cacheNames) {
            await caches.delete(cacheName);
          }
          addStatus('Cleared Cache API');
        }

        // 7. Clear Redux persist state
        console.log('Clearing Redux persist state...');
        const reduxKeys = Object.keys(localStorage).filter(key => key.startsWith('persist:'));
        reduxKeys.forEach(key => localStorage.removeItem(key));
        addStatus('Cleared Redux persist state');

        // Show success
        statusBox.classList.add('success');
        
        console.log('‚úÖ Dashboard reset complete!');
        
      } catch (error) {
        console.error('Error during reset:', error);
        alert('Error: ' + error.message);
        btnText.textContent = 'Reset Everything';
        document.querySelector('.btn-danger').disabled = false;
      }
    }

    // Add confirmation before leaving
    window.addEventListener('beforeunload', (e) => {
      if (document.getElementById('statusBox').classList.contains('success')) {
        return; // Allow reload after success
      }
    });
  </script>
</body>
</html>
